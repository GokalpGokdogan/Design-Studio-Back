{
    "type": "json_schema",
    "json_schema": {
        "name": "ui_design_spec_dsl",
        "description": "Structured UI design using a layout DSL (row/stack/grid/box/component) plus figmaTokens and optional floating overlays.",
        "schema": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "meta": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "title": { "type": "string" },
                        "prompt": { "type": "string" }
                    },
                    "required": ["title", "prompt"]
                },
                "artboard": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "width": {
                            "type": "number",
                            "minimum": 300,
                            "maximum": 4096
                        },
                        "height": {
                            "type": "number",
                            "minimum": 300,
                            "maximum": 4096
                        },
                        "background": { "type": "string" }
                    },
                    "required": ["width", "height", "background"]
                },
                "tree": { "$ref": "#/$defs/node" },
                "floating": {
                    "type": "array",
                    "items": { "$ref": "#/$defs/floatingNode" }
                }
            },
            "required": ["meta", "artboard", "tree"],
            "$defs": {
                "style": {
                    "type": "object",
                    "description": "Inline style using tokens where applicable.",
                    "additionalProperties": true
                },
                "componentRole": {
                    "type": "string",
                    "enum": [
                        "heading",
                        "paragraph",
                        "button",
                        "input",
                        "img",
                        "svg",
                        "card",
                        "link",
                        "divider"
                    ]
                },
                "component": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "type": { "const": "component" },
                        "role": { "$ref": "#/$defs/componentRole" },
                        "content": { "type": "string" },
                        "props": { "type": "object" },
                        "style": { "$ref": "#/$defs/style" }
                    },
                    "required": ["type", "role"]
                },
                "containerBase": {
                    "type": "object",
                    "properties": {
                        "gap": { "type": ["string", "number"] },
                        "padding": { "type": ["string", "number"] },
                        "align": {
                            "type": "string",
                            "enum": ["start", "center", "end", "stretch"]
                        },
                        "justify": {
                            "type": "string",
                            "enum": ["start", "center", "end", "between"]
                        },
                        "style": { "$ref": "#/$defs/style" },
                        "children": {
                            "type": "array",
                            "items": { "$ref": "#/$defs/node" }
                        }
                    },
                    "required": ["children"],
                    "additionalProperties": false
                },
                "row": {
                    "allOf": [
                        { "$ref": "#/$defs/containerBase" },
                        {
                            "type": "object",
                            "properties": { "type": { "const": "row" } },
                            "required": ["type"]
                        }
                    ]
                },
                "stack": {
                    "allOf": [
                        { "$ref": "#/$defs/containerBase" },
                        {
                            "type": "object",
                            "properties": {
                                "type": { "const": "stack" },
                                "direction": {
                                    "type": "string",
                                    "enum": ["column", "row"]
                                }
                            },
                            "required": ["type"]
                        }
                    ]
                },
                "grid": {
                    "allOf": [
                        { "$ref": "#/$defs/containerBase" },
                        {
                            "type": "object",
                            "properties": {
                                "type": { "const": "grid" },
                                "cols": {
                                    "type": "object",
                                    "additionalProperties": false,
                                    "properties": {
                                        "base": {
                                            "type": "integer",
                                            "minimum": 1,
                                            "maximum": 12
                                        },
                                        "md": {
                                            "type": "integer",
                                            "minimum": 1,
                                            "maximum": 12
                                        },
                                        "lg": {
                                            "type": "integer",
                                            "minimum": 1,
                                            "maximum": 12
                                        }
                                    },
                                    "required": ["base"]
                                }
                            },
                            "required": ["type", "cols"]
                        }
                    ]
                },
                "box": {
                    "allOf": [
                        { "$ref": "#/$defs/containerBase" },
                        {
                            "type": "object",
                            "properties": { "type": { "const": "box" } },
                            "required": ["type"]
                        }
                    ]
                },
                "node": {
                    "oneOf": [
                        { "$ref": "#/$defs/component" },
                        { "$ref": "#/$defs/row" },
                        { "$ref": "#/$defs/stack" },
                        { "$ref": "#/$defs/grid" },
                        { "$ref": "#/$defs/box" }
                    ]
                },
                "floatingNode": {
                    "type": "object",
                    "additionalProperties": false,
                    "properties": {
                        "position": {
                            "type": "object",
                            "properties": {
                                "top": { "type": "number" },
                                "left": { "type": "number" },
                                "right": { "type": "number" },
                                "bottom": { "type": "number" }
                            },
                            "minProperties": 1
                        },
                        "node": { "$ref": "#/$defs/node" }
                    },
                    "required": ["position", "node"]
                }
            }
        }
    }
}
